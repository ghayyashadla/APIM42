<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITSM Form</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
   

    <button id="authorize-btn">Authorize</button>

    <script>
        document.getElementById('authorize-btn').addEventListener('click', function() {
            // Authenticate with API token
            const token = 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1bmlxdWVfbmFtZSI6ImltYWdvdmVydW0uY29tXFx2dmFsZW50aW5lIiwibmFtZWlkIjoiaW1hZ292ZXJ1bS5jb21cXHZ2YWxlbnRpbmUiLCJVc2VyRnJhZ21lbnRJZCI6IjRjOTc4NmUwLWEzMGEtZTUxMS04MGQ4LTAwNTA1NjJmOTUxNiIsImlzcyI6Imh0dHBzOi8vc3RzLm1hdHJpeDQyLmNvbSIsImF1ZCI6InVybjptYXRyaXg0MkFwaSIsImV4cCI6MjE0NzQ4MzY0NSwibmJmIjoxNzA3MTMwOTg1fQ.zXTiSZeoROQ6k4leAnnUm69hFuV3eBJtJDh6SV99GhY';
            const headers = {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            };

            // Send authentication request to get bearer token
            fetch('https://cors-anywhere.herokuapp.com/https://twe044srv.imagoverum.com/m42Services/api/ApiToken/GenerateAccessTokenFromApiToken', {
                method: 'POST',
                headers: headers
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Authentication failed');
                }
                return response.json();
            })
            .then(data => {
                const accessToken = data.accessToken;
                console.log('Bearer Token:', accessToken);

                // After getting the bearer token, you can proceed to submit the form
                submitFormWithBearerToken(accessToken);
            })
            .catch(error => {
                console.error('Authentication failed:', error);
                // Handle authentication error
            });
        });

        function submitFormWithBearerToken(accessToken) {
            const formData = new FormData(document.getElementById('itsm-form'));
            const user = formData.get('user');
            const urgency = formData.get('urgency');
            const creator = formData.get('creator');
            const subject = formData.get('subject');
            const description = formData.get('description');
            const priority = formData.get('priority');

            const ticketData = {
                user: user,
                urgency: urgency,
                creator: creator,
                subject: subject,
                description: description,
                priority: priority
            };

            const ticketHeaders = {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json'
            };

            fetch('https://twe044srv.imagoverum.com/m42Services/api/ticket/create?activitytype=5', {
                method: 'POST',
                headers: ticketHeaders,
                body: JSON.stringify(ticketData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log('Form submitted successfully:', data);
                // Handle success response from the API
            })
            .catch(error => {
                console.error('There was a problem with your fetch operation:', error);
                // Handle error
            });
        }
    </script>
</body>
</html>
             -->
<!DOCTYPE html>
<body>
<button id="authorize-btn">Authorize</button>
</body>
<script>

document.getElementById('authorize-btn').addEventListener('click', function() {
    // Step 2: Exchange API token for Access Token

    var xmlhttp = new XMLHttpRequest();
    xmlhttp.open('POST', 'https://twe044srv.imagoverum.com/M42Services/api/ApiToken/GenerateAccessTokenFromApiToken/', true);
    xmlhttp.setRequestHeader("Content-Type", "application/json");
    xmlhttp.setRequestHeader('Authorization', 'Bearer' + 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1bmlxdWVfbmFtZSI6ImltYWdvdmVydW0uY29tXFx2dmFsZW50aW5lIiwibmFtZWlkIjoiaW1hZ292ZXJ1bS5jb21cXHZ2YWxlbnRpbmUiLCJVc2VyRnJhZ21lbnRJZCI6IjRjOTc4NmUwLWEzMGEtZTUxMS04MGQ4LTAwNTA1NjJmOTUxNiIsImlzcyI6Imh0dHBzOi8vc3RzLm1hdHJpeDQyLmNvbSIsImF1ZCI6InVybjptYXRyaXg0MkFwaSIsImV4cCI6MjE0NzQ4MzY0NSwibmJmIjoxNzA3MTMwOTg1fQ.zXTiSZeoROQ6k4leAnnUm69hFuV3eBJtJDh6SV99GhY');
    xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            if (this.responseText !== null) {
                var accessToken = JSON.parse(this.responseText).RawToken;
                console.log('Access token obtained:', accessToken);
                // Optionally, you can perform further actions after obtaining the access token
            } else {
                console.log('Not a valid or disabled API token');
            }
        }
    };
    xmlhttp.send();
});
</script>
